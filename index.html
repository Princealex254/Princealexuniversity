<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login | Prince Alex Design University</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <style>
    body { font-family: 'Roboto', sans-serif; }
    #authContainer {
      background: url('myschoolgate.png') no-repeat center center fixed;
      background-size: cover;
    }
    .form-wrapper {
      background-color: #ffffff;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .btn-primary {
      background-color: #0d6efd;
      color: white;
      font-weight: bold;
      padding: 0.75rem 1.5rem;
      border-radius: 6px;
    }
    .btn-primary:hover { background-color: #0a58ca; }

    /* Custom Alert Styles */
    .custom-alert-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999; /* Ensure it's on top */
    }
    .custom-alert-content {
        background: white;
        padding: 25px;
        border-radius: 8px;
        text-align: center;
        max-width: 400px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    .custom-alert-content p {
        margin-bottom: 0;
        font-size: 1.1em;
        color: #1a1a1a; /* Default text color */
    }
    .custom-alert-content button {
        background-color: #0d6efd; /* Primary blue for OK button */
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1em;
        transition: background-color .3s ease;
    }
    .custom-alert-content button:hover {
        background-color: #0a58ca;
    }
    /* Specific styles for alert types */
    .custom-alert-content.error {
        background-color: #dc3545; /* Red for error */
        color: white;
    }
    .custom-alert-content.success {
        background-color: #28a745; /* Green for success */
        color: white;
    }
    .custom-alert-content.info {
        background-color: #002d6b; /* Dark Blue for info */
        color: white;
    }
  </style>
</head>
<body class="h-screen flex items-center justify-center">

  <!-- Loading overlay -->
  <div id="loadingOverlay" class="fixed inset-0 bg-white bg-opacity-80 flex flex-col justify-center items-center hidden">
    <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-blue-700"></div>
    <div class="mt-4 text-xl text-blue-700">Loading...</div>
  </div>

  <!-- Auth container -->
  <div id="authContainer" class="w-full h-full flex justify-center items-center p-4">
    <!-- Login Form -->
    <div id="login-form-wrapper" class="form-wrapper p-8 w-full max-w-md text-center">
      <form id="login-form">
        <h2 class="text-3xl font-extrabold mb-8 text-blue-600">Login</h2>
        <div class="mb-6 text-left">
          <label>Email</label>
          <input type="email" id="email-login" required class="w-full px-4 py-2 border rounded-lg"/>
        </div>
        <div class="mb-6 text-left">
          <label>Password</label>
          <input type="password" id="password-login" required class="w-full px-4 py-2 border rounded-lg"/>
        </div>
        <button type="submit" class="w-full btn-primary">Login</button>
        <div class="mt-6 text-sm flex justify-between">
          <a href="#" onclick="showForm('signup')">Sign Up</a>
          <a href="#" onclick="showForm('forgot')">Forgot Password?</a>
        </div>
      </form>
    </div>

    <!-- Signup Form -->
    <div id="signup-form-wrapper" class="form-wrapper p-8 w-full max-w-md text-center hidden">
      <form id="signup-form">
        <h2 class="text-3xl font-extrabold mb-8 text-blue-600">Sign Up</h2>
        <div class="mb-6 text-left">
          <label>Full Name</label>
          <input type="text" id="full-name-signup" required class="w-full px-4 py-2 border rounded-lg"/>
        </div>
        <div class="mb-6 text-left">
          <label>Email</label>
          <input type="email" id="email-signup" required class="w-full px-4 py-2 border rounded-lg"/>
        </div>
        <div class="mb-6 text-left">
          <label>Password</label>
          <input type="password" id="password-signup" required class="w-full px-4 py-2 border rounded-lg"/>
        </div>
        <button type="submit" class="w-full btn-primary">Sign Up</button>
        <div class="mt-6 text-sm">
          <a href="#" onclick="showForm('login')">Already have an account? Login</a>
        </div>
      </form>
    </div>

    <!-- Forgot Password -->
    <div id="forgot-form-wrapper" class="form-wrapper p-8 w-full max-w-md text-center hidden">
      <form id="forgot-form">
        <h2 class="text-3xl font-extrabold mb-8 text-blue-600">Recover Password</h2>
        <div class="mb-6 text-left">
          <label>Email</label>
          <input type="email" id="email-forgot" required class="w-full px-4 py-2 border rounded-lg"/>
        </div>
        <button type="submit" class="w-full btn-primary">Send Reset Link</button>
        <div class="mt-6 text-sm">
          <a href="#" onclick="showForm('login')">Back to Login</a>
        </div>
      </form>
    </div>
  </div>

  <!-- Firebase & Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC0TdBjLeGimGoYZwLxzC4fQLPBdSzrT0A",
      authDomain: "universityweb-19e1e.firebaseapp.com",
      projectId: "universityweb-19e1e",
      storageBucket: "universityweb-19e1e.appspot.com",
      messagingSenderId: "401942926589",
      appId: "1:401942926589:web:c98e8d71ae6bd396775a94"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const loadingOverlay = document.getElementById('loadingOverlay');

    // Custom Alert function
    function showCustomAlert(message, type = 'info', callback = null) {
        const modal = document.createElement('div');
        modal.classList.add('custom-alert-modal');

        let bgColorClass = 'info'; // Default to info blue
        if (type === 'error') { bgColorClass = 'error'; }
        else if (type === 'success') { bgColorClass = 'success'; }

        modal.innerHTML = `
            <div class="custom-alert-content ${bgColorClass}">
                <p>${message}</p>
                <button onclick="this.parentNode.parentNode.remove(); if(typeof window.alertCallback === 'function') window.alertCallback();">OK</button>
            </div>
        `;
        document.body.appendChild(modal);
        window.alertCallback = callback; // Store callback globally
    }

    // Function to process Firebase error messages into user-friendly ones
    function getFriendlyErrorMessage(errorCode) {
        switch (errorCode) {
            case 'auth/invalid-email':
            case 'auth/wrong-password':
            case 'auth/user-not-found':
            case 'auth/invalid-credential':
                return 'Invalid email or password.';
            case 'auth/email-already-in-use':
                return 'This email address is already in use.';
            case 'auth/weak-password':
                return 'Password should be at least 6 characters.';
            case 'auth/network-request-failed':
                return 'Network error. Please check your connection.';
            case 'auth/too-many-requests':
                return 'Too many login attempts. Please try again later.';
            default:
                return 'An unexpected error occurred. Please try again.';
        }
    }

    // Show forms
    window.showForm = (form) => {
      document.getElementById("login-form-wrapper").classList.add("hidden");
      document.getElementById("signup-form-wrapper").classList.add("hidden");
      document.getElementById("forgot-form-wrapper").classList.add("hidden");
      document.getElementById(`${form}-form-wrapper`).classList.remove("hidden");
    };

    // Login
    document.getElementById("login-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      loadingOverlay.classList.remove('hidden'); // Show loading
      const email = document.getElementById("email-login").value;
      const password = document.getElementById("password-login").value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
        window.location.href = "dashboard.html"; // Redirect on success
      } catch (error) {
        console.error("Firebase Login Error:", error.code, error.message); // Log original error for debugging
        showCustomAlert(getFriendlyErrorMessage(error.code), 'error'); // Use custom alert with friendly message
      } finally {
        loadingOverlay.classList.add('hidden'); // Hide loading
      }
    });

    // Signup
    document.getElementById("signup-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      loadingOverlay.classList.remove('hidden'); // Show loading
      const email = document.getElementById("email-signup").value;
      const password = document.getElementById("password-signup").value;
      try {
        await createUserWithEmailAndPassword(auth, email, password);
        showCustomAlert("Account created! Please login.", 'success', () => showForm("login")); // Use custom alert, then show login form
      } catch (error) {
        console.error("Firebase Signup Error:", error.code, error.message); // Log original error for debugging
        showCustomAlert(getFriendlyErrorMessage(error.code), 'error'); // Use custom alert with friendly message
      } finally {
        loadingOverlay.classList.add('hidden'); // Hide loading
      }
    });

    // Forgot Password
    document.getElementById("forgot-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      loadingOverlay.classList.remove('hidden'); // Show loading
      const email = document.getElementById("email-forgot").value;
      try {
        await sendPasswordResetEmail(auth, email);
        showCustomAlert("Password reset link sent to your email.", 'info', () => showForm("login")); // Use custom alert, then show login form
      } catch (error) {
        console.error("Firebase Forgot Password Error:", error.code, error.message); // Log original error for debugging
        showCustomAlert(getFriendlyErrorMessage(error.code), 'error'); // Use custom alert with friendly message
      } finally {
        loadingOverlay.classList.add('hidden'); // Hide loading
      }
    });

    // Redirect if already logged in (This should ideally also show a loading state)
    onAuthStateChanged(auth, (user) => {
      if (user) {
        loadingOverlay.classList.remove('hidden'); // Show loading if redirecting
        window.location.href = "dashboard.html";
      }
    });
  </script>
</body>
</html>
