<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Courses - Prince Alex University</title>
    <!--
    ====================================================================================================
    FILE: my-courses.html
    PURPOSE: Displays the student's enrolled courses with details, filtering, and actions.
    ====================================================================================================
    -->
    <style>
        /* --- CSS Variables for Theming (Same as dashboard.html) --- */
        :root, [data-theme="light"] {
            --color-primary: #1A237E; --color-primary-light: #303F9F; --color-accent: #FFC107; --color-accent-hover: #FFA000; --color-text: #212121; --color-text-muted: #757575; --color-bg: #F5F5F5; --color-surface: #FFFFFF; --color-border: #E0E0E0; --color-error: #D32F2F; --color-success: #388E3C; --color-info: #1976D2; --color-warning: #FFA000;
            --font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; --shadow-sm: 0 1px 3px rgba(0,0,0,0.08); --shadow-md: 0 3px 6px rgba(0,0,0,0.12); --border-radius: 8px; --transition-speed: 0.3s;
        }
        [data-theme="dark"] {
            --color-primary: #9FA8DA; --color-primary-light: #7986CB; --color-accent: #FFCA28; --color-accent-hover: #FFD54F; --color-text: #E0E0E0; --color-text-muted: #9E9E9E; --color-bg: #121212; --color-surface: #1E1E1E; --color-border: #424242;
        }

        /* --- Global Styles & Resets (Same as dashboard.html) --- */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { font-size: 16px; }
        body {
            font-family: var(--font-family); background-color: var(--color-bg); color: var(--color-text); transition: background-color var(--transition-speed), color var(--transition-speed);
            display: grid; grid-template-columns: 250px 1fr; grid-template-rows: auto 1fr auto;
            grid-template-areas: "sidebar header" "sidebar main" "sidebar footer"; min-height: 100vh;
        }
        a { color: var(--color-primary); text-decoration: none; }
        a:hover { text-decoration: underline; }
        img { max-width: 100%; display: block; }

        /* --- Layout Components (Same as dashboard.html) --- */
        .header { grid-area: header; display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; background-color: var(--color-surface); border-bottom: 1px solid var(--color-border); box-shadow: var(--shadow-sm); position: sticky; top: 0; z-index: 100; }
        .sidebar { grid-area: sidebar; background-color: var(--color-primary); color: #E8EAF6; padding: 1.5rem 0; display: flex; flex-direction: column; position: fixed; height: 100%; width: 250px; transition: transform var(--transition-speed) ease; }
        .main-content { grid-area: main; padding: 2rem; }
        .footer { grid-area: footer; padding: 1rem 2rem; text-align: center; font-size: 0.8rem; color: var(--color-text-muted); border-top: 1px solid var(--color-border); }

        /* --- Header Components (Same as dashboard.html) --- */
        .header__title { font-size: 1.5rem; font-weight: 600; }
        .header__actions { display: flex; align-items: center; gap: 1.5rem; }
        .notification-bell { position: relative; cursor: pointer; }
        .notification-badge { position: absolute; top: -5px; right: -8px; background-color: var(--color-error); color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 0.7rem; display: flex; justify-content: center; align-items: center; font-weight: 600; }
        .user-menu { position: relative; }
        .user-menu__avatar { width: 40px; height: 40px; border-radius: 50%; cursor: pointer; }
        .user-menu__dropdown { display: none; position: absolute; right: 0; top: 50px; background-color: var(--color-surface); border: 1px solid var(--color-border); border-radius: var(--border-radius); box-shadow: var(--shadow-md); width: 180px; z-index: 110; }
        .user-menu__dropdown a { display: block; padding: 0.75rem 1rem; color: var(--color-text); }
        .user-menu__dropdown a:hover { background-color: var(--color-bg); }
        .user-menu.active .user-menu__dropdown { display: block; }

        /* --- Sidebar Components (Same as dashboard.html) --- */
        .sidebar__logo { font-size: 1.5rem; font-weight: 700; text-align: center; padding: 0 1rem 1.5rem; color: white; }
        .sidebar__logo .accent { color: var(--color-accent); }
        .sidebar__nav { overflow-y: auto; }
        .sidebar__nav ul { list-style: none; }
        .sidebar__nav-item a { display: flex; align-items: center; gap: 1rem; padding: 0.9rem 1.5rem; color: #C5CAE9; transition: background-color var(--transition-speed), color var(--transition-speed); border-left: 4px solid transparent; }
        .sidebar__nav-item a:hover { background-color: rgba(0,0,0,0.2); color: white; }
        .sidebar__nav-item.active a { background-color: rgba(0,0,0,0.3); color: white; font-weight: 600; border-left-color: var(--color-accent); }
        .sidebar__nav-icon { width: 20px; height: 20px; }
        .sidebar__footer { margin-top: auto; padding: 1rem; }
        .hamburger-menu { display: none; cursor: pointer; z-index: 102; }

        /* --- General UI Components --- */
        .card { background-color: var(--color-surface); border-radius: var(--border-radius); box-shadow: var(--shadow-sm); padding: 1.5rem; transition: all var(--transition-speed); }
        .card:hover { box-shadow: var(--shadow-md); }
        .card__title { font-size: 1.2rem; font-weight: 600; margin-bottom: 1rem; }
        .btn { display: inline-block; padding: 0.6rem 1.2rem; font-size: 0.9rem; font-weight: 600; text-align: center; border-radius: var(--border-radius); cursor: pointer; transition: all var(--transition-speed); border: 1px solid transparent; }
        .btn--primary { background-color: var(--color-primary); color: white; }
        .btn--primary:hover { background-color: var(--color-primary-light); }
        .btn--secondary { background-color: transparent; color: var(--color-primary); border-color: var(--color-primary); }
        .btn--secondary:hover { background-color: rgba(26, 35, 126, 0.05); }
        .btn--danger { background-color: var(--color-error); color: white; }
        .btn--danger:hover { background-color: #C62828; }
        .btn-group { display: flex; gap: 0.5rem; flex-wrap: wrap; }

        /* --- Page-Specific Styles: My Courses --- */
        .page-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
            align-items: center;
        }
        .page-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;
        }
        .search-box { flex-grow: 1; position: relative; }
        .search-box input { width: 100%; padding: 0.75rem 1rem 0.75rem 2.5rem; font-size: 1rem; border: 1px solid var(--color-border); border-radius: var(--border-radius); background-color: var(--color-surface); }
        .search-box svg { position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); color: var(--color-text-muted); }
        .filter-group { display: flex; gap: 1rem; }
        .filter-group select { padding: 0.75rem; border: 1px solid var(--color-border); border-radius: var(--border-radius); background-color: var(--color-surface); color: var(--color-text); }
        .modal-body .catalog-item { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; border-radius: var(--border-radius); transition: background-color var(--transition-speed); }
        .modal-body .catalog-item:hover { background-color: var(--color-bg); }

        /* --- Table Styles --- */
        .table-wrapper { overflow-x: auto; background-color: var(--color-surface); border-radius: var(--border-radius); box-shadow: var(--shadow-sm); }
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th, .data-table td { padding: 1rem; text-align: left; border-bottom: 1px solid var(--color-border); font-size: 0.9rem; }
        .data-table thead th { background-color: var(--color-bg); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; color: var(--color-text-muted); }
        .data-table tbody tr:last-child td { border-bottom: none; }

        .course-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
        }
        .course-card { display: flex; flex-direction: column; gap: 1rem; }
        .course-card__header { display: flex; justify-content: space-between; align-items: flex-start; }
        .course-card__code { font-size: 0.9rem; font-weight: 600; color: var(--color-text-muted); }
        .course-card__title { font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; }
        .course-card__lecturer { font-size: 0.9rem; color: var(--color-text-muted); }
        .course-card__meta { display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--color-text-muted); margin-top: 1rem; }
        .course-card__progress { margin-top: auto; padding-top: 1rem; }
        .progress-bar { width: 100%; height: 8px; background-color: var(--color-bg); border-radius: 4px; overflow: hidden; }
        .progress-bar__inner { height: 100%; background-color: var(--color-primary); border-radius: 4px; transition: width var(--transition-speed); }
        .course-card__actions { border-top: 1px solid var(--color-border); padding-top: 1rem; margin-top: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap; }

        /* --- Modal Styles --- */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); }
        .modal.open { display: flex; align-items: center; justify-content: center; }
        .modal-content {
            background-color: var(--color-surface); color: var(--color-text); margin: auto; padding: 2rem; border: 1px solid var(--color-border);
            width: 90%; max-width: 600px; border-radius: var(--border-radius); box-shadow: var(--shadow-md); position: relative;
            animation: modal-fade-in 0.3s ease;
        }
        @keyframes modal-fade-in { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .modal-close { position: absolute; top: 1rem; right: 1rem; color: var(--color-text-muted); font-size: 1.5rem; font-weight: bold; cursor: pointer; border: none; background: none; }
        .modal-close:hover, .modal-close:focus { color: var(--color-text); text-decoration: none; }
        .modal-header { margin-bottom: 1.5rem; }
        .modal-title { font-size: 1.5rem; font-weight: 600; }
        .modal-body { max-height: 60vh; overflow-y: auto; }
        .modal-footer { margin-top: 1.5rem; text-align: right; display: flex; justify-content: flex-end; gap: 0.75rem; }
        .detail-group { margin-bottom: 1rem; }
        .detail-group dt { font-weight: 600; color: var(--color-text-muted); margin-bottom: 0.25rem; }
        .detail-group dd { margin-left: 0; }

        /* --- Responsive Adjustments --- */
        @media (max-width: 1024px) {
            body { grid-template-columns: 1fr; grid-template-areas: "header" "main" "footer"; }
            .sidebar { transform: translateX(-100%); z-index: 200; }
            .sidebar.open { transform: translateX(0); box-shadow: 5px 0 15px rgba(0,0,0,0.2); }
            .hamburger-menu { display: block; padding: 0.5rem; }
            .header { padding: 1rem; }
        }
        @media (max-width: 768px) {
            .main-content { padding: 1rem; }
            .page-controls { flex-direction: column; align-items: stretch; }
        }
    </style>
</head>
<body data-theme="light">

    <header class="header">
        <div class="hamburger-menu" id="hamburgerMenu" aria-label="Open navigation menu" role="button" tabindex="0">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        </div>
        <h1 class="header__title">My Courses</h1>
        <div class="header__actions">
            <div class="notification-bell" id="notificationBell">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
                <span class="notification-badge" id="notificationCount"></span>
            </div>
            <div class="user-menu" id="userMenu">
                <img src="https://i.pravatar.cc/150?u=alexdoe" alt="User Avatar" class="user-menu__avatar" id="userAvatar">
                <div class="user-menu__dropdown">
                    <a href="profile.html">Profile</a>
                    <a href="settings.html#theme-settings">Settings</a>
                    <a href="index.html" id="logoutBtn">Logout</a>
                </div>
            </div>
        </div>
    </header>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar__logo">Prince Alex <span class="accent">U.</span></div>
        <nav class="sidebar__nav">
            <ul>
                <li class="sidebar__nav-item" id="nav-dashboard"><a href="dashboard.html">
                    <svg class="sidebar__nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                    <span>Dashboard</span>
                </a></li>
                <li class="sidebar__nav-item" id="nav-profile"><a href="profile.html">
                    <svg class="sidebar__nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                    <span>Profile</span>
                </a></li>
                <li class="sidebar__nav-item active" id="nav-my-courses"><a href="my-courses.html">
                    <svg class="sidebar__nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
                    <span>My Courses</span>
                </a></li>
                <li class="sidebar__nav-item" id="nav-results"><a href="results.html">
                    <svg class="sidebar__nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                    <span>My Results</span>
                </a></li>
                <li class="sidebar__nav-item" id="nav-fee-statement"><a href="fee-statement.html">
                    <svg class="sidebar__nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                    <span>Fee Statement</span>
                </a></li>
                <li class="sidebar__nav-item" id="nav-timetable"><a href="timetable.html">
                    <svg class="sidebar__nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                    <span>Timetable</span>
                </a></li>
                <li class="sidebar__nav-item" id="nav-library"><a href="library.html">
                    <svg class="sidebar__nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
                    <span>Library</span>
                </a></li>
                <li class="sidebar__nav-item" id="nav-hostel"><a href="hostel.html">
                    <svg class="sidebar__nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5"></path><path d="M2 12l10 5 10-5"></path></svg>
                    <span>Hostel</span>
                </a></li>
                <li class="sidebar__nav-item" id="nav-messages"><a href="messages.html">
                    <svg class="sidebar__nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                    <span>Messages</span>
                </a></li>
                <li class="sidebar__nav-item" id="nav-support"><a href="support.html">
                    <svg class="sidebar__nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                    <span>Support</span>
                </a></li>
                <li class="sidebar__nav-item" id="nav-graduation"><a href="graduation.html">
                    <svg class="sidebar__nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10v6M2 10v6M12 2v10.5M12 22v-1.5M12 12.5a4.5 4.5 0 0 0 4.5-4.5c0-2.49-2.02-4.5-4.5-4.5s-4.5 2.01-4.5 4.5A4.5 4.5 0 0 0 12 12.5zM12 12.5a4.5 4.5 0 0 1-4.5 4.5c0 2.49 2.02 4.5 4.5 4.5s4.5-2.01 4.5-4.5A4.5 4.5 0 0 1 12 12.5z"></path></svg>
                    <span>Graduation</span>
                </a></li>
                <li class="sidebar__nav-item" id="nav-clearance"><a href="clearance.html">
                    <svg class="sidebar__nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>
                    <span>Clearance</span>
                </a></li>
                <li class="sidebar__nav-item" id="nav-settings"><a href="settings.html">
                    <svg class="sidebar__nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                    <span>Settings</span>
                </a></li>
            </ul>
        </nav>
    </aside>

    <main class="main-content">
        <div class="page-header">
            <button id="registerCourseBtn" class="btn btn--primary">Register for Courses</button>
        </div>
        <div class="page-controls">
            <div class="search-box">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <input type="search" id="courseSearch" placeholder="Search by course code, title, or lecturer...">
            </div>
            <div class="filter-group">
                <select id="sortControl" aria-label="Sort courses">
                    <option value="code-asc">Sort by Code (A-Z)</option>
                    <option value="code-desc">Sort by Code (Z-A)</option>
                    <option value="title-asc">Sort by Title (A-Z)</option>
                    <option value="progress-desc">Sort by Progress (High-Low)</option>
                </select>
            </div>
        </div>

        <div class="table-wrapper">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Code</th>
                        <th>Title</th>
                        <th>Lecturer</th>
                        <th>Credits</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="courseList"></tbody>
            </table>
        </div>
        <p id="noResultsMessage" style="display: none; text-align: center; margin-top: 2rem; color: var(--color-text-muted);">No courses match your criteria.</p>
    </main>

    <footer class="footer">
        <p>&copy; 2024 Prince Alex University. All Rights Reserved. | Portal Version 1.0</p>
    </footer>

    <!-- Course Details Modal -->
    <div id="detailsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="detailsModalTitle" aria-hidden="true">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close modal">&times;</button>
            <div class="modal-header">
                <h2 id="detailsModalTitle" class="modal-title">Course Details</h2>
            </div>
            <div class="modal-body" id="detailsModalBody">
                <!-- Details will be injected here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn--secondary modal-close">Close</button>
            </div>
        </div>
    </div>

    <!-- Drop Course Confirmation Modal -->
    <div id="confirmModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="confirmModalTitle" aria-hidden="true">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close modal">&times;</button>
            <div class="modal-header">
                <h2 id="confirmModalTitle" class="modal-title">Confirm Action</h2>
            </div>
            <div class="modal-body">
                <p id="confirmModalText">Are you sure you want to drop this course? This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn--secondary modal-close">Cancel</button>
                <button id="confirmDropBtn" class="btn btn--danger">Yes, Drop Course</button>
            </div>
        </div>
    </div>

    <!-- Course Registration Modal -->
    <div id="registrationModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="registrationModalTitle" aria-hidden="true">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close modal">&times;</button>
            <div class="modal-header">
                <h2 id="registrationModalTitle" class="modal-title">Course Catalog</h2>
            </div>
            <div class="search-box" style="padding: 0 1.5rem 1rem;">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <input type="search" id="catalogSearch" placeholder="Search by course code or title...">
            </div>
            <div class="modal-body" id="courseCatalogBody">
                <!-- Master course list will be injected here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn--secondary modal-close">Close</button>
            </div>
        </div>
    </div>

    <!-- Message Overlay -->
    <div id="messageOverlay" class="message-overlay" style="display:none;position:fixed;z-index:2000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5);justify-content:center;align-items:center;">
        <div id="messageOverlayContent" style="background-color:var(--color-surface);padding:2rem;border-radius:var(--border-radius);box-shadow:var(--shadow-md);width:90%;max-width:400px;text-align:center;">
            <p id="messageOverlayText" style="margin-bottom:1.5rem;font-size:1.1rem;line-height:1.5;"></p>
            <button id="messageOverlayClose" class="btn btn--primary">OK</button>
        </div>
    </div>


    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, collection, getDocs, deleteDoc, query, where, addDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC0TdBjLeGimGoYZwLxzC4fQLPBdSzrT0A",
            authDomain: "universityweb-19e1e.firebaseapp.com",
            projectId: "universityweb-19e1e",
            storageBucket: "universityweb-19e1e.firebasestorage.app",
            messagingSenderId: "401942926589",
            appId: "1:401942926589:web:c98e8d71ae6bd396775a94"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            const userDocRef = doc(db, "users", user.uid);
            const userDocSnap = await getDoc(userDocRef);
            const userProfile = userDocSnap.exists() ? userDocSnap.data() : {};
            initializePage(user, userProfile);
        } else {
            window.location.href = 'index.html';
        }
    });

    async function initializePage(user, userProfile) {
        // --- Common UI Setup ---
        const sidebar = document.getElementById('sidebar');
        const hamburgerMenu = document.getElementById('hamburgerMenu');
        if (hamburgerMenu) hamburgerMenu.addEventListener('click', () => sidebar.classList.toggle('open'));
        const userMenu = document.getElementById('userMenu');
        if (userMenu) userMenu.addEventListener('click', (e) => { e.stopPropagation(); userMenu.classList.toggle('active'); });
        document.addEventListener('click', () => { if (userMenu && userMenu.classList.contains('active')) userMenu.classList.remove('active'); });
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) logoutBtn.addEventListener('click', async (e) => { e.preventDefault(); await signOut(auth); });
        const currentTheme = userProfile?.theme || 'light';
        document.body.setAttribute('data-theme', currentTheme);
        const currentPage = window.location.pathname.split('/').pop();
        const navId = 'nav-' + currentPage.replace('.html', '');
        const activeNavItem = document.getElementById(navId);
        if (activeNavItem) {
            document.querySelectorAll('.sidebar__nav-item').forEach(item => item.classList.remove('active'));
            activeNavItem.classList.add('active');
        }
        const userAvatar = document.getElementById('userAvatar');
        if (userAvatar && userProfile) {
            userAvatar.src = userProfile.avatar;
            userAvatar.alt = `${userProfile.name}'s avatar`;
        }
        const messagesCol = collection(db, "users", user.uid, "messages");
        const unreadMessagesSnapshot = await getDocs(query(messagesCol, where("read", "==", false)));
        const notificationCountEl = document.getElementById('notificationCount');
        if (notificationCountEl) {
            const unreadCount = unreadMessagesSnapshot.size;
            if (unreadCount > 0) {
                notificationCountEl.textContent = unreadCount;
                notificationCountEl.style.display = 'flex';
            } else {
                notificationCountEl.style.display = 'none';
            }
        }

        // --- MY-COURSES-SPECIFIC SCRIPT ---
        const courseListEl = document.getElementById('courseList');
        const searchInput = document.getElementById('courseSearch');
        const sortControl = document.getElementById('sortControl');
        const noResultsMessage = document.getElementById('noResultsMessage');
        const detailsModal = document.getElementById('detailsModal');
        const registrationModal = document.getElementById('registrationModal');
        const confirmModal = document.getElementById('confirmModal');
        let courseToDropId = null;
        let masterCourseCatalog = [];
        let allCourses = [];

        const sanitize = (str) => {
            const temp = document.createElement('div');
            temp.textContent = str;
            return temp.innerHTML;
        };

        function showMessage(message, type = 'success') {
            const overlay = document.getElementById('messageOverlay');
            const content = document.getElementById('messageOverlayContent');
            const text = document.getElementById('messageOverlayText');

            text.textContent = message;
            content.className = 'message-overlay-content'; // Reset classes
            content.style.backgroundColor = 'var(--color-surface)';
            content.style.color = 'var(--color-text)';
            content.classList.add(type); // 'success' or 'error'

            overlay.classList.add('show');
        }

        // Add overlay styles dynamically for dark theme
        const overlayStyle = document.createElement('style');
        overlayStyle.innerHTML = `
            .message-overlay.show { display: flex; }
            .message-overlay-content.success { border-top: 4px solid var(--color-success); }
            .message-overlay-content.error { border-top: 4px solid var(--color-error); }
        `;
        document.head.appendChild(overlayStyle);
        function renderCourses(courses) {
            courseListEl.innerHTML = '';
            if (courses.length === 0) {
                noResultsMessage.style.display = 'block';
                return;
            }
            noResultsMessage.style.display = 'none';

            courses.forEach(course => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sanitize(course.code)}</td>
                    <td>${sanitize(course.title)}</td>
                    <td>${sanitize(course.lecturer)}</td>
                    <td>${course.credits}</td>
                    <td>
                        <div class="btn-group">
                        <button class="btn btn--primary view-details-btn" data-course-id="${course.id}">View Details</button>
                        <button class="btn btn--danger drop-course-btn" data-course-id="${course.id}">Drop Course</button>
                        </div>
                    </td>
                `;
                courseListEl.appendChild(row);
            });
            addCardActionListeners();
        }

        function renderCourseCatalog() {
            const catalogBody = document.getElementById('courseCatalogBody');
            const catalogSearch = document.getElementById('catalogSearch');
            const searchTerm = catalogSearch.value.toLowerCase();
            catalogBody.innerHTML = '';

            const filteredCatalog = masterCourseCatalog.filter(course => 
                (course.title && course.title.toLowerCase().includes(searchTerm)) ||
                (course.code && course.code.toLowerCase().includes(searchTerm))
            );

            if (filteredCatalog.length === 0) {
                catalogBody.innerHTML = '<p style="text-align: center; padding: 1rem;">No courses match your search.</p>';
                return;
            }

            filteredCatalog.forEach(course => {
                const alreadyEnrolled = allCourses.some(enrolled => enrolled.code === course.code);
                const item = document.createElement('div');
                item.className = 'catalog-item';
                item.innerHTML = `
                    <div>
                        <strong>${sanitize(course.title)} (${sanitize(course.code)})</strong>
                        <div style="font-size: 0.9rem; color: var(--color-text-muted);">
                            ${sanitize(course.lecturer)} &bull; ${course.credits} Credits &bull; 
                            Year ${sanitize(course.yearOfStudy || 'N/A')} &bull; ${sanitize(course.semester || 'N/A')}
                        </div>
                    </div>
                    <button class="btn btn-sm btn--primary register-btn" data-course-id="${course.id}" ${alreadyEnrolled ? 'disabled' : ''}>
                        ${alreadyEnrolled ? 'Enrolled' : 'Register'}
                    </button>
                `;
                catalogBody.appendChild(item);
            });

            document.querySelectorAll('.register-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const clickedButton = e.currentTarget;
                    const courseId = e.currentTarget.dataset.courseId;
                    const courseToRegister = masterCourseCatalog.find(c => c.id === courseId);
                    if (courseToRegister) {
                        try {
                            clickedButton.disabled = true;
                            clickedButton.textContent = 'Enrolling...';

                            const studentCoursesCol = collection(db, "users", user.uid, "courses");
                            const newCourseData = { ...courseToRegister, progress: 0, grade: null, gradePoint: null };
                            await setDoc(doc(studentCoursesCol, courseId), newCourseData); // Use master course ID

                            // Optimistic UI Update: Add to local array and re-render immediately
                            allCourses.push({ id: courseId, ...newCourseData });
                            applyFiltersAndSort();

                            showMessage(`Successfully registered for ${courseToRegister.title}!`, 'success');
                            closeModal(registrationModal);
                        } catch (error) {
                            console.error("Error registering for course:", error);
                            showMessage("Failed to register for the course.", "error");
                            clickedButton.disabled = false;
                            clickedButton.textContent = 'Register';
                        }
                    }
                });
            });
        }

        function applyFiltersAndSort() {
            const searchTerm = searchInput.value.toLowerCase();
            const sortValue = sortControl.value;
            let filteredCourses = allCourses.filter(course =>
                (course.title && course.title.toLowerCase().includes(searchTerm)) ||
                (course.code && course.code.toLowerCase().includes(searchTerm)) ||
                (course.lecturer && course.lecturer.toLowerCase().includes(searchTerm))
            );
            filteredCourses.sort((a, b) => {
                switch (sortValue) {
                    case 'code-asc': return a.code.localeCompare(b.code);
                    case 'code-desc': return b.code.localeCompare(a.code);
                    case 'title-asc': return a.title.localeCompare(b.title);
                    case 'progress-desc': return b.progress - a.progress;
                    default: return 0;
                }
            });
            renderCourses(filteredCourses);
        }

        function addCardActionListeners() {
            document.querySelectorAll('.view-details-btn').forEach(btn => btn.addEventListener('click', (e) => showDetailsModal(e.currentTarget.dataset.courseId)));
            document.querySelectorAll('.download-materials-btn').forEach(btn => btn.addEventListener('click', () => showMessage('Simulating download of course materials...', 'info')));
            document.querySelectorAll('.drop-course-btn').forEach(btn => btn.addEventListener('click', (e) => showConfirmModal(e.currentTarget.dataset.courseId)));
        }

        function setupModals() {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                const closeButtons = modal.querySelectorAll('.modal-close');
                closeButtons.forEach(button => button.addEventListener('click', () => closeModal(modal)));
                modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(modal); });
            });
            document.addEventListener('keydown', (e) => { if (e.key === "Escape") modals.forEach(closeModal); });
            document.getElementById('messageOverlayClose').addEventListener('click', () => {
                document.getElementById('messageOverlay').classList.remove('show');
            });
        }

        function openModal(modal) { modal.classList.add('open'); modal.setAttribute('aria-hidden', 'false'); document.body.style.overflow = 'hidden'; }
        function closeModal(modal) { modal.classList.remove('open'); modal.setAttribute('aria-hidden', 'true'); document.body.style.overflow = ''; }

        function showDetailsModal(courseId) {
            const course = allCourses.find(c => c.id === courseId);
            if (!course) return;
            document.getElementById('detailsModalTitle').textContent = `${course.code}: ${course.title}`;
            document.getElementById('detailsModalBody').innerHTML = `...`; // Details rendering logic
            openModal(detailsModal);
        }

        function showConfirmModal(courseId) {
            courseToDropId = courseId;
            const course = allCourses.find(c => c.id === courseId);
            if (!course) return;
            document.getElementById('confirmModalText').innerHTML = `Are you sure you want to drop <strong>${sanitize(course.title)}</strong>? This action cannot be undone.`;
            openModal(confirmModal);
        }

        async function handleDropCourse() {
            if (!courseToDropId) return;
            const courseDocRef = doc(db, "users", user.uid, "courses", courseToDropId);
            await deleteDoc(courseDocRef);
            console.log(`Dropped course ${courseToDropId}`);
            courseToDropId = null;
            closeModal(confirmModal);
            await fetchAndRenderCourses(); // Re-fetch and re-render            
            showMessage('Course has been dropped successfully.', 'success');
        }

        async function fetchAndRenderCourses() {
            const coursesCol = collection(db, "users", user.uid, "courses");
            const courseSnapshot = await getDocs(coursesCol);
            allCourses = courseSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            applyFiltersAndSort();
        }

        async function fetchMasterCatalog() {
            const coursesCol = collection(db, "courses");
            const courseSnapshot = await getDocs(coursesCol);
            masterCourseCatalog = courseSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        }

        async function init() {
            // Initial setup
            await fetchAndRenderCourses();
            searchInput.addEventListener('input', applyFiltersAndSort);
            sortControl.addEventListener('change', applyFiltersAndSort);
            document.getElementById('confirmDropBtn').addEventListener('click', handleDropCourse);
            document.getElementById('registerCourseBtn').addEventListener('click', async () => { await fetchMasterCatalog(); renderCourseCatalog(); openModal(registrationModal); });
            document.getElementById('catalogSearch').addEventListener('input', renderCourseCatalog);
            setupModals();
        }

        await init();
    }
    </script>

</body>
</html>
